<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ridu AI ðŸ¤– â€“ Brother Bot</title>
<style>
  body { font-family: Arial; background:#111; color:#fff; padding:20px; margin:0; }
  #chat-box { height:70vh; overflow-y:auto; border:1px solid #444; padding:10px; border-radius:10px; }
  .msg { margin:10px 0; padding:10px; border-radius:10px; max-width:75%; word-wrap: break-word; }
  .user { background:#007bff; margin-left:auto; }
  .ridu { background:#ff4747; margin-right:auto; }
  input, button { padding:10px; border-radius:10px; font-size:16px; }
  input { width: 75%; margin-right: 10px; background:#222; color:#fff; border:none; }
  button { width: 20%; background:#ff4747; color:#fff; border:none; cursor:pointer; }
  button:disabled { opacity:0.6; cursor:not-allowed; }
</style>
</head>
<body>

<h2 style="text-align:center;">Ridu AI ðŸ¤– â€“ Your Brother Bot</h2>
<div id="chat-box"></div>

<div style="display:flex; margin-top:10px;">
  <input id="input" placeholder="Type here..." autocomplete="off">
  <button id="sendBtn">Send</button>
</div>

<script>
const systemPrompt = `
You are Ridu AI â€” a funny, protective brother.
Speak in Hinglish (WhatsApp style English).
Use light roasts, slang, humor.
Comfort her when sad. Motivate her using Islamic wisdom.
Be caring, bold, funny, and real.
If she talks about food, give ideas & recipes.
If she feels stressed, calm her.
If she asks anything educational, answer properly.
`;

const chatBox = document.getElementById("chat-box");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");

function addMessage(text, sender) {
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.innerText = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";
  addMessage("...", "ridu"); // typing indicator
  sendBtn.disabled = true;

  try {
    const res = await fetch("/.netlify/functions/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        messages: [
          { role: "system", content: systemPrompt },
          { role: "user", content: text }
        ]
      })
    });

    const data = await res.json();
    const reply = data.choices?.[0]?.message?.content || "Error: No reply.";
    chatBox.lastChild.innerText = reply;

  } catch (e) {
    chatBox.lastChild.innerText = "Error contacting AI.";
    console.error(e);
  }

  sendBtn.disabled = false;
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keydown", (e) => { if(e.key === "Enter") sendMessage(); });
</script>

</body>
</html>
